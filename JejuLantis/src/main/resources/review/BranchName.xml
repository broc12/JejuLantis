<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="review.BranchName">
	
	<resultMap id="reviewResult" type="BranchName">
		<result property="branch_line_no" column="BRANCH_LINE_NO"/>
        <result property="branch_name" column="BRANCH_NAME"/>
		<collection property="reviewList" column="{a=BRANCH_LINE_NO}" javaType="ArrayList" select="review.ReviewContent.reviewContent"/>
	</resultMap>
	<select id="branchName" parameterType="HashMap" resultMap="reviewResult">
		select DISTINCT BRANCH_LINE_NO, BRANCH_NAME
		from BRANCH 
		order by BRANCH_NAME  
    </select> 		
	<select id="branchNameSelect" parameterType="HashMap" resultMap="reviewResult">
		select BRANCH.BRANCH_NAME, REV.* 
		from BRANCH, 
		(select RENT_REVIEW.BRANCH_LINE_NO, 
		avg(RENT_REVIEW.Rent_Review_Rating_Car) as SCORE, count(*) as SALE, 
		max(RENT_REVIEW.RENT_REVIEW_DATE) as NEW 
		from RENT_REVIEW 
		group by RENT_REVIEW.BRANCH_LINE_NO ) REV
		where REV.BRANCH_LINE_NO = BRANCH.BRANCH_LINE_NO
		<if test="review_sel != null"> ORDER BY 
	  		<choose>
	    		<when test="review_sel eq 'SCORE'"> SCORE </when>
	    		<when test="review_sel eq 'SALE'"> SALE </when>
	    		<when test="review_sel eq 'NEW'"> NEW </when>
	  		</choose>
	  	DESC
  		</if>
    </select> 		    
</mapper>
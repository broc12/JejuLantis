<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "query.member">

<resultMap type="Member" id="MemberResult">
	<result column="MEMBER_NO" property="member_no"/>
	<result column="MEMBER_ID" property="member_id"/>
	<result column="MEMBER_PWD" property="member_pwd"/>
	<result column="MEMBER_NAME" property="member_name"/>
	<result column="MEMBER_BIRTH" property="member_birth"/>
	<result column="MEMBER_SEX" property="member_sex"/>
	<result column="MEMBER_LOCAL" property="member_local"/>
	<result column="MEMBER_TEL" property="member_tel"/>
	<result column="MEMBER_EMAIL" property="member_email"/>
	<result column="MEMBER_SMS_AT" property="member_sms_at"/>
	<result column="MEMBER_EMAIL_AT" property="member_email_at"/>
	<result column="MEMBER_RESIST_MEMBER" property="member_resist_member"/>
	<result column="MEMBER_WITHDRAW_AT" property="member_withdraw_at"/>
	<result column="MEMBER_WITHDRAW_DATE" property="member_withdraw_date"/>
	<result column="COUPON_NO" property="coupon_no"/>
	<result column="COUPON_NAME" property="coupon_name"/>
	<result column="COUPON_DISCOUNT" property="coupon_discount"/>
	<result column="COUPON_START" property="coupon_start"/>
	<result column="COUPON_END" property="coupon_end"/>
	<result column="COUPON_NUMBER" property="coupon_number"/>
	<result column="COUPON_RESIST" property="coupon_resist"/>
	<result column="COUPON_USEDATE" property="coupon_usedate"/>
	<result column="COUPON_USEYN" property="coupon_useyn"/>
</resultMap>

	
<insert id="memberjoin" parameterType="Member">
<selectKey keyProperty="member_no" resultType="long" order="BEFORE">
select MEMBER_seq.nextval from DUAL
</selectKey>
insert into MEMBER values (#{member_no},#{member_id},#{member_pwd},#{member_name},#{member_birth},'M',#{member_local},#{member_tel},#{member_email},#{member_sms_at},
	SYSDATE,#{member_withdraw_at},SYSDATE)
<!--   insert into MEMBER(member_no,id,pwd,name,birth,sex,sclc,memeber_local,tel,email,sms_at,resist_member,memeber_whithdraw_at) -->
<!--   values (MEMBER_seq.nextval,#{id},#{pwd},#{name},SYSDATE,#{sex},#{sclc},#{memeber_local},#{tel},#{email},#{sms_at},SYSDATE,#{memeber_whithdraw_at}) -->
</insert>

<select id="idcheck" parameterType="String" resultType="Integer">
      SELECT COUNT(*) FROM MEMBER
      WHERE
          member_id = #{member_id} 
</select>

<select id="emailcheck" parameterType="String" resultType="Integer">
      SELECT COUNT(*) FROM MEMBER
      WHERE
          member_email = #{member_email} 
</select>

<select id="idview" parameterType="String" resultType="Member">
      SELECT * FROM MEMBER
      WHERE
          member_id = #{member_id}
</select>

<update id="modify" parameterType="Member" >
	 UPDATE member SET member_id = #{member_id} , member_pwd = #{member_pwd}, member_name = #{member_name}, member_tel = #{member_tel} ,member_birth = #{member_birth}, member_local = #{member_local}
        WHERE member_id = #{member_id} 
<!--         AND pwd = #{pwd}  -->
</update>

<delete id="delete" parameterType="String" >
<!--         DELETE FROM member WHERE id=#{id} -->
UPDATE member SET member_withdraw_at  ='y' where member_id=#{member_id}
    </delete>
    
   <!-- 아이디 찾기 -->
	<select id="find_id" parameterType="String" resultType="String">
		select member_id from member where member_email = #{member_email}
	</select>
	
	 <!-- 아이디 찾기 -->
	<select id="find_pwd" parameterType="String" resultType="String">
		select member_pwd from member where member_id = #{member_id}
	</select>
	<!-- 로그인 체키쿼리 -->
	<select id="loginCheck" resultType="Member" parameterType="Member"> 
		select * from MEMBER
		<where>
		MEMBER_ID = #{member_id}
			AND
		MEMBER_PWD = #{member_pwd}	
			AND 	
		MEMBER_WITHDRAW_AT ='N'
		</where>
	</select>
	
<!-- 	select -->
	<select id="totalAccount" resultType="integer">
		SELECT COUNT(*) FROM MEMBER
	</select>
<!-- 네이버 아이디 체크 -->
	<select id="checkMember" resultType="Member">
		SELECT * FROM MEMBER WHERE MEMBER_ID=#{id}
	</select>
<!-- 네이버 아이디 가입 -->
	<insert id="joinNaver">
	INSERT INTO MEMBER VALUES(MEMBER_SEQ.NEXTVAL,#{member_id},'NAVER',#{member_name},#{member_birth},'M','서울',
	'010-5454-4885',#{member_email},'N',SYSDATE,'N',SYSDATE)
	</insert>
	
	
<!--  <update id="deletemodify" parameterType="String" > -->
<!--  	UPDATE member SET memeber_whithdraw_at  ='y' where id=#{id} -->
<!--  </update> -->

<!-- <select id="modify" parameterType="HashMap" resultType="int"> -->
<!-- 			select count(ID) from (select * from MEMBER where PWD=#{pwd}) where ID = #{id} -->
<!-- 		</select> -->
	
<!--    <select id="viewMember"  parameterType="String" resultType="Integer"> -->
<!--         SELECT  -->
<!--           * -->
<!--         FROM member -->
<!--         WHERE id = #{id} -->
<!--     </select> -->
<!-- <update id="modify" parameterType="User"> -->
<!--         UPDATE member SET name = #{name}, tel = #{tel} -->
<!--         WHERE email = #{email} AND pwd = #{pwd} -->
<!--     </update> -->
</mapper>